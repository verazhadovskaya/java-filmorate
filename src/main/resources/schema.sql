DROP TABLE IF EXISTS genre CASCADE;
DROP TABLE IF EXISTS request_status CASCADE;
DROP TABLE IF EXISTS rating CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS films CASCADE;
DROP TABLE IF EXISTS film_likes CASCADE;
DROP TABLE IF EXISTS film_genre CASCADE;
DROP TABLE IF EXISTS friend_request CASCADE;

CREATE TABLE IF NOT EXISTS users (
    id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR(255) NOT NULL,
    login VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    birthday DATE
);

DROP SEQUENCE IF EXISTS user_seq;
CREATE SEQUENCE IF NOT EXISTS user_seq START WITH 1 minvalue 1 INCREMENT BY 1;

CREATE TABLE IF NOT EXISTS rating (
	id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    rating_name VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS films (
    id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description VARCHAR(200) NOT NULL,
    release_date TIMESTAMP NOT NULL,
    duration INT NOT NULL,
    rating_id INT REFERENCES rating(id) ON DELETE RESTRICT ON UPDATE CASCADE
);

DROP SEQUENCE IF EXISTS film_seq;
CREATE SEQUENCE IF NOT EXISTS film_seq START WITH 1 minvalue 1 INCREMENT BY 1;

CREATE TABLE IF NOT EXISTS request_status (
    id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    request_status VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS friend_request (
	id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    friend_id INT NOT NULL REFERENCES users (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    request_status_id INT NOT NULL REFERENCES request_status (id) ON DELETE RESTRICT ON UPDATE CASCADE
);
DROP SEQUENCE IF EXISTS friend_request_seq;
CREATE SEQUENCE IF NOT EXISTS friend_request_seq START WITH 1 minvalue 1 INCREMENT BY 1;



CREATE TABLE IF NOT EXISTS film_likes (
	id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    film_id INT NOT NULL REFERENCES films (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    user_id INT NOT NULL REFERENCES users (id) ON DELETE RESTRICT ON UPDATE CASCADE
);

DROP SEQUENCE IF EXISTS likes_seq;
CREATE SEQUENCE IF NOT EXISTS likes_seq START WITH 1 minvalue 1 INCREMENT BY 1;

CREATE TABLE IF NOT EXISTS genre (
	id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    genre_name VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS film_genre (
	id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    film_id INT NOT NULL REFERENCES films (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    genre_id INT NOT NULL REFERENCES genre (id) ON DELETE RESTRICT ON UPDATE CASCADE
);

DROP SEQUENCE IF EXISTS film_genre_seq;
CREATE SEQUENCE IF NOT EXISTS film_genre_seq START WITH 1 minvalue 1 INCREMENT BY 1;



